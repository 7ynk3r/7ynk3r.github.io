name: Gemini Research and Create File

on:
  workflow_dispatch: # Allows manual triggering

jobs:
  research:
    runs-on: ubuntu-latest
    permissions:
      contents: "write" # Required to commit the new file
    steps:
      - name: Checkout repository
        uses: actions/checkout@v4

      - name: Run Gemini CLI
        id: gemini_run
        uses: google-github-actions/run-gemini-cli@v0.1.12
        with:
          prompt: "Write a brief summary about the current state of AI development and key trends in 2025. Format the response as markdown with 3 main points."
          gemini_api_key: ${{ secrets.GEMINI_API_KEY }}
          gemini_cli_version: "latest"
          gemini_debug: false
          gemini_model: "gemini-1.5-flash"

      - name: Debug Gemini outputs
        run: |
          echo "=== Gemini Response ==="
          echo "Length: ${#GEMINI_RESPONSE}"
          echo "Content: $GEMINI_RESPONSE"
          echo ""
          echo "=== Gemini Errors ==="
          echo "Length: ${#GEMINI_ERRORS}"
          echo "Content: $GEMINI_ERRORS"
          echo ""
          echo "=== Creating file ==="
          if [ -n "$GEMINI_RESPONSE" ]; then
            echo "$GEMINI_RESPONSE" > ai_news.md
          elif [ -n "$GEMINI_ERRORS" ]; then
            echo "Error occurred: $GEMINI_ERRORS" > ai_news.md
          else
            echo "No response from Gemini CLI" > ai_news.md
          fi
        env:
          GEMINI_RESPONSE: ${{ steps.gemini_run.outputs.gemini_response }}
          GEMINI_ERRORS: ${{ steps.gemini_run.outputs.gemini_errors }}

      - name: Verify file content
        run: |
          echo "File created: ai_news.md"
          cat ai_news.md

      - name: Commit the new file
        run: |
          git config --global user.name 'github-actions[bot]'
          git config --global user.email 'github-actions[bot]@users.noreply.github.com'
          git add ai_news.md
          git commit -m "Add latest AI news summary"
          git push
